name: $(Build.Major).$(Build.Minor).$(date:yyMM).$(DayOfMonth)$(rev:rr)

trigger:
- main

pr:
- main
- feature/*
- features/*
- release/*

variables:
  Build.Major: 0
  Build.Minor: 1
  Drops.Dir: $(Build.ArtifactStagingDirectory)/drops

schedules:
- cron: "0 9 * * Sat"
  displayName: 'Build for Component Governance'
  branches:
    include:
    - main
  always: true

jobs:
- job: "QDKPython"
  pool: 
    vmImage: 'ubuntu-latest'
  strategy:
    matrix:
      qdk:
        packageName: 'qdk'
        envPath: 'qdk/environment.yml'
        envName: qdk
      azure-quantum:
        packageName: 'azure-quantum'
        envPath: 'azure-quantum/environment.yml'
        envName: azurequantum
      azure-quantum-cirq-beta:
        packageName: 'azure-quantum'
        envPath: 'azure-quantum/azure/quantum/plugins/environment-cirq-beta.yml'
        envName: azurequantumcirqbeta
        skipWheel: true
  steps:
  - template: steps.yml
    parameters:
      packageName: '$(packageName)'
      envPath: '$(envPath)'
      envName: '$(envName)'
      skipWheel: $(skipWheel)
  - task: ms.vss-governance-buildtask.governance-build-task-component-detection.ComponentGovernanceComponentDetection@0
    displayName: 'Component detection'
