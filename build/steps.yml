parameters:
- name: packageName
  type: string
  default: 'azure-quantum'
- name: envPath
  type: string
  default: ''
- name: envName
  type: string
  default: ''
- name: pack
  type: string
  default: 'false'


steps:
- pwsh: |
    Write-Host "Parameters: ${{ parameters.packageName }}, ${{ parameters.envPath }}, ${{ parameters.envName }}, ${{ parameters.pack }}"
- pwsh: ./bootstrap.ps1 -EnvPath ${{ parameters.envPath }}
  displayName: Create ${{ parameters.envName }} conda environment
- pwsh: build/build.ps1 ${{ parameters.packageName }} -EnvNames ${{ parameters.envName }} -FromSource $True
  displayName: Install ${{ parameters.packageName }} package in env
- pwsh: build/pack.ps1 ${{ parameters.packageName }} -EnvNames ${{ parameters.envName }}
  displayName: Pack ${{ parameters.packageName }}
  condition: variables.doPack
- pwsh: build/test.ps1 ${{ parameters.packageName }} -EnvNames ${{ parameters.envName }}
  displayName: Test ${{ parameters.packageName }}
